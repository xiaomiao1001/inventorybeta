<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è®¢å•è¯¦æƒ…</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f7f8fa;
        }
        .status-bar {
            background: #000;
            color: #fff;
            font-size: 14px;
            font-weight: 600;
        }
        .nav-bar {
            background: #fff;
            border-bottom: 1px solid #e5e5e5;
        }
        .detail-section {
            background: #fff;
            border-radius: 12px;
            margin: 12px 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }
        .status-header {
            background: linear-gradient(135deg, #0066cc, #0052a3);
            color: white;
            border-radius: 12px 12px 0 0;
        }
        .status-step {
            position: relative;
            padding: 12px 0;
        }
        .status-step::before {
            content: '';
            position: absolute;
            left: 20px;
            top: 40px;
            bottom: -12px;
            width: 2px;
            background: #e5e5e5;
        }
        .status-step.completed::before {
            background: #0066cc;
        }
        .status-step:last-child::before {
            display: none;
        }
        .status-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e5e5e5;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            z-index: 1;
        }
        .status-icon.completed {
            background: #0066cc;
            color: white;
        }
        .status-icon.current {
            background: #ff6b6b;
            color: white;
        }
        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        .info-row:last-child {
            border-bottom: none;
        }
        .price-highlight {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            border-radius: 20px;
            padding: 4px 12px;
            font-weight: 600;
        }
        .total-amount {
            background: linear-gradient(135deg, #0066cc, #0052a3);
            color: white;
            border-radius: 12px;
            padding: 16px;
            text-align: center;
        }
        .config-tag {
            background: #f0f7ff;
            color: #0066cc;
            border: 1px solid #0066cc;
            border-radius: 16px;
            padding: 4px 12px;
            font-size: 12px;
            margin: 2px;
            display: inline-block;
        }
        .btn-primary {
            background: linear-gradient(135deg, #0066cc, #0052a3);
            border-radius: 24px;
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .btn-secondary {
            background: #f7f8fa;
            border: 1px solid #d0d0d0;
            border-radius: 24px;
            color: #666;
            font-weight: 600;
        }
        .btn-cancel {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            border-radius: 24px;
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .btn-cancel:hover {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }
    </style>
</head>
<body>
    <!-- çŠ¶æ€æ  -->
    <div class="status-bar h-11 flex items-center justify-between px-6">
        <div class="flex items-center space-x-1">
            <span>9:41</span>
        </div>
        <div class="flex items-center space-x-1">
            <i class="fas fa-signal text-sm"></i>
            <i class="fas fa-wifi text-sm"></i>
            <i class="fas fa-battery-three-quarters text-sm"></i>
        </div>
    </div>

    <!-- å¯¼èˆªæ  -->
    <div class="nav-bar h-16 flex items-center justify-between px-4">
        <div class="flex items-center space-x-4">
            <i class="fas fa-chevron-left text-gray-600 text-lg cursor-pointer" onclick="goBack()"></i>
            <h1 class="text-lg font-semibold text-gray-800">è®¢å•è¯¦æƒ…</h1>
        </div>
    </div>

    <!-- ä¸»è¦å†…å®¹ -->
    <div class="pb-20">
        <!-- è®¢å•çŠ¶æ€ -->
        <div class="detail-section">
            <div class="status-header p-4">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="text-lg font-semibold mb-1">ğŸš— å·²æäº¤å¾…ç¡®è®¤è°ƒè½¦</div>
                        <div class="text-sm opacity-90">è®¢å•å·: <span data-order-no>HR20250122001</span></div>
                    </div>
                    <div class="text-right">
                        <div class="text-sm opacity-90">é¢„è®¡å¤„ç†æ—¶é—´</div>
                        <div class="font-semibold">1-2ä¸ªå·¥ä½œæ—¥</div>
                    </div>
                </div>
            </div>

            <!-- çŠ¶æ€æµç¨‹ -->
            <div class="p-4">
                <div class="status-step completed">
                    <div class="flex items-center">
                        <div class="status-icon completed">
                            <i class="fas fa-check text-sm"></i>
                        </div>
                        <div class="ml-4 flex-1">
                            <div class="font-medium text-gray-800">è®¢å•å·²æäº¤</div>
                            <div class="text-sm text-gray-500">2025-01-22 14:30</div>
                        </div>
                    </div>
                </div>

                <div class="status-step current">
                    <div class="flex items-center">
                        <div class="status-icon current">
                            <i class="fas fa-clock text-sm"></i>
                        </div>
                        <div class="ml-4 flex-1">
                            <div class="font-medium text-gray-800">ç­‰å¾…ç¡®è®¤è°ƒè½¦</div>
                            <div class="text-sm text-gray-500">é¢„è®¡ä»Šæ—¥å¤„ç†</div>
                        </div>
                    </div>
                </div>

                <div class="status-step">
                    <div class="flex items-center">
                        <div class="status-icon">
                            <i class="fas fa-truck text-sm text-gray-400"></i>
                        </div>
                        <div class="ml-4 flex-1">
                            <div class="font-medium text-gray-400">å‡†å¤‡å‘è´§</div>
                            <div class="text-sm text-gray-400">ç­‰å¾…ä¸Šä¸€æ­¥å®Œæˆ</div>
                        </div>
                    </div>
                </div>

                <div class="status-step">
                    <div class="flex items-center">
                        <div class="status-icon">
                            <i class="fas fa-check-circle text-sm text-gray-400"></i>
                        </div>
                        <div class="ml-4 flex-1">
                            <div class="font-medium text-gray-400">è®¢å•å®Œæˆ</div>
                            <div class="text-sm text-gray-400">ç­‰å¾…ä¸Šä¸€æ­¥å®Œæˆ</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- è½¦è¾†ä¿¡æ¯ -->
        <div class="detail-section">
            <div class="p-4 border-b border-gray-100">
                <h2 class="text-lg font-semibold text-gray-800 flex items-center">
                    <i class="fas fa-car text-blue-500 mr-2"></i>
                    è½¦è¾†ä¿¡æ¯
                </h2>
            </div>
            
            <div class="p-4">
                <!-- è½¦è¾†å›¾ç‰‡ -->
                <div class="mb-4">
                    <img src="https://images.unsplash.com/photo-1558618666-fbd2c5cd5d92?w=400&h=200&fit=crop&crop=center" 
                         alt="è½¦è¾†å›¾ç‰‡" class="w-full h-32 object-cover rounded-lg">
                </div>

                <div class="info-row">
                    <span class="text-gray-600">ç»é”€å•†</span>
                    <span class="text-gray-800 font-medium">jxs-qx (é«˜çº§æ‰¹å‘å•†)</span>
                </div>
                <div class="info-row">
                    <span class="text-gray-600">è½¦å‹ç³»åˆ—</span>
                    <span class="text-gray-800 font-medium" data-vehicle-series>é¸¿æ—¥S1</span>
                </div>
                <div class="info-row">
                    <span class="text-gray-600">è½¦å‹</span>
                    <span class="text-gray-800 font-medium" data-vehicle-model>S1-23æ¬¾ç£·é…¸é“é”‚4kwå¿ƒåŠ¨ç‰ˆ</span>
                </div>
                <div class="info-row">
                    <span class="text-gray-600">é…ç½®</span>
                    <span class="text-gray-800 font-medium" data-vehicle-config>æ ‡é…</span>
                </div>
                <div class="info-row">
                    <span class="text-gray-600">é¢œè‰²</span>
                    <div class="flex items-center">
                        <div class="w-4 h-4 bg-red-500 rounded-full mr-2"></div>
                        <span class="text-gray-800 font-medium" data-vehicle-color>çº¢è‰²</span>
                    </div>
                </div>
                <div class="info-row">
                    <span class="text-gray-600">åŸºç¡€ä»·æ ¼</span>
                    <span class="price-highlight" data-base-price>Â¥21,900</span>
                </div>
            </div>
        </div>

        <!-- å¢åŠ é…ç½® -->
        <div class="detail-section">
            <div class="p-4 border-b border-gray-100">
                <h2 class="text-lg font-semibold text-gray-800 flex items-center">
                    <i class="fas fa-plus-circle text-green-500 mr-2"></i>
                    å¢åŠ é…ç½®
                </h2>
            </div>
            
            <div class="p-4">
                <div class="info-row">
                    <span class="text-gray-600">é”‚ç”µæ± +é”‚ç”µåŠ è£…æ‰‹å·¥è´¹</span>
                    <span class="price-highlight">Â¥4,200</span>
                </div>
                <div class="info-row">
                    <span class="text-gray-600">æ–¹å‘åŠ©åŠ›</span>
                    <span class="price-highlight">Â¥680</span>
                </div>
                <div class="info-row">
                    <span class="text-gray-600 font-semibold">é…ç½®å°è®¡</span>
                    <span class="text-lg font-semibold text-blue-600" data-config-total>Â¥4,880</span>
                </div>
            </div>
        </div>

        <!-- å…¶ä»–è´¹ç”¨ -->
        <div class="detail-section">
            <div class="p-4 border-b border-gray-100">
                <h2 class="text-lg font-semibold text-gray-800 flex items-center">
                    <i class="fas fa-calculator text-orange-500 mr-2"></i>
                    å…¶ä»–è´¹ç”¨
                </h2>
            </div>
            
            <div class="p-4">
                <div class="info-row">
                    <span class="text-gray-600">ä¿é™©+è£…è½¦è´¹</span>
                    <span class="text-gray-800 font-medium">Â¥80</span>
                </div>
                <div class="info-row">
                    <span class="text-gray-600">è¿è´¹</span>
                    <span class="text-gray-800 font-medium">Â¥1,150</span>
                </div>
                <div class="info-row">
                    <span class="text-gray-600">åŠ ä»·</span>
                    <span class="text-gray-800 font-medium">Â¥400</span>
                </div>
                <div class="info-row">
                    <span class="text-gray-600">å¥–åŠ±æ ¸å‡</span>
                    <span class="text-gray-800 font-medium">Â¥0</span>
                </div>
                <div class="info-row">
                    <span class="text-gray-600 font-semibold">è´¹ç”¨å°è®¡</span>
                    <span class="text-lg font-semibold text-orange-600">Â¥1,630</span>
                </div>
            </div>
        </div>

        <!-- æè½¦æ–¹å¼ -->
        <div class="detail-section">
            <div class="p-4 border-b border-gray-100">
                <h2 class="text-lg font-semibold text-gray-800 flex items-center">
                    <i class="fas fa-truck text-purple-500 mr-2"></i>
                    æè½¦æ–¹å¼
                </h2>
            </div>
            
            <div class="p-4">
                <div class="info-row">
                    <span class="text-gray-600">æè½¦æ–¹å¼</span>
                    <span class="text-gray-800 font-medium">ç‰©æµå‘è¿</span>
                </div>
                <div class="info-row">
                    <span class="text-gray-600">æœåŠ¡è´¹ç”¨</span>
                    <span class="text-green-600 font-medium">å…è´¹</span>
                </div>
            </div>
        </div>

        <!-- è®¢å•é‡‘é¢æ±‡æ€» -->
        <div class="detail-section">
            <div class="total-amount">
                <div class="text-sm opacity-90 mb-2">è®¢å•æ€»é¢</div>
                <div class="text-3xl font-bold mb-3" data-total-amount>Â¥28,410</div>
                <div class="text-sm opacity-75 space-y-1">
                    <div>åŸºç¡€ä»·æ ¼: <span data-base-price>Â¥21,900</span></div>
                    <div>å¢åŠ é…ç½®: +<span data-config-total>Â¥4,880</span></div>
                    <div>å…¶ä»–è´¹ç”¨: +Â¥1,630</div>
                    <div>æè½¦æœåŠ¡è´¹: Â¥0</div>
                </div>
            </div>
        </div>

        <!-- è®¢å•ä¿¡æ¯ -->
        <div class="detail-section">
            <div class="p-4 border-b border-gray-100">
                <h2 class="text-lg font-semibold text-gray-800 flex items-center">
                    <i class="fas fa-info-circle text-gray-500 mr-2"></i>
                    è®¢å•ä¿¡æ¯
                </h2>
            </div>
            
            <div class="p-4">
                <div class="info-row">
                    <span class="text-gray-600">è®¢å•å·</span>
                    <span class="text-gray-800 font-medium" data-order-no>HR20250122001</span>
                </div>
                <div class="info-row">
                    <span class="text-gray-600">ä¸‹å•æ—¶é—´</span>
                    <span class="text-gray-800 font-medium" data-created-at>2025-01-22 14:30:25</span>
                </div>
                <div class="info-row">
                    <span class="text-gray-600">æäº¤æ—¶é—´</span>
                    <span class="text-gray-800 font-medium" data-submitted-at>2025-01-22 14:30:25</span>
                </div>
                <div class="info-row">
                    <span class="text-gray-600">ç¡®è®¤æ—¶é—´</span>
                    <span class="text-gray-400">å¾…ç¡®è®¤</span>
                </div>
                <div class="info-row">
                    <span class="text-gray-600">å‘è´§æ—¶é—´</span>
                    <span class="text-gray-400">å¾…å‘è´§</span>
                </div>
            </div>
        </div>
    </div>

    <!-- åº•éƒ¨æ“ä½œæ  -->
    <div class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4">
        <div class="flex space-x-3" id="bottomActions">
            <!-- é»˜è®¤æ˜¾ç¤ºè”ç³»å®¢æœæŒ‰é’® -->
            <button class="btn-secondary flex-1 h-12 flex items-center justify-center">
                <i class="fas fa-phone mr-2"></i>
                è”ç³»å®¢æœ
            </button>
            
            <!-- å½“è®¢å•çŠ¶æ€ä¸ºå·²æäº¤æ—¶æ˜¾ç¤ºå–æ¶ˆè®¢å•æŒ‰é’® -->
            <button class="btn-cancel flex-1 h-12 flex items-center justify-center text-white" 
                    id="cancelOrderBtn" style="display: none;" onclick="cancelOrder()">
                <i class="fas fa-times mr-2"></i>
                å–æ¶ˆè®¢å•
            </button>
        </div>
    </div>

    <script>
        // è®¢å•æ•°æ® - ä»URLå‚æ•°æˆ–localStorageè·å–
        let orderData = null;

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadOrderData();
            initializeOrderDetail();
        });

        // åŠ è½½è®¢å•æ•°æ®
        function loadOrderData() {
            try {
                // ä»URLå‚æ•°è·å–è®¢å•å·
                const urlParams = new URLSearchParams(window.location.search);
                const orderNo = urlParams.get('orderNo');
                
                if (orderNo) {
                    // ä»localStorageä¸­æŸ¥æ‰¾å¯¹åº”çš„è®¢å•
                    const orders = JSON.parse(localStorage.getItem('dealerOrders') || '[]');
                    const foundOrder = orders.find(order => order.orderNo === orderNo);
                    
                    if (foundOrder) {
                        orderData = foundOrder;
                        console.log('æ‰¾åˆ°è®¢å•æ•°æ®:', orderData);
                        // æ›´æ–°é¡µé¢æ˜¾ç¤º
                        updatePageContent();
                    } else {
                        console.warn('æœªæ‰¾åˆ°è®¢å•:', orderNo);
                        // ä½¿ç”¨é»˜è®¤æ•°æ®
                        orderData = getDefaultOrderData();
                    }
                } else {
                    console.warn('URLä¸­æ²¡æœ‰è®¢å•å·å‚æ•°ï¼Œä½¿ç”¨é»˜è®¤æ•°æ®');
                    // ä½¿ç”¨é»˜è®¤æ•°æ®
                    orderData = getDefaultOrderData();
                }
            } catch (error) {
                console.error('åŠ è½½è®¢å•æ•°æ®å¤±è´¥:', error);
                orderData = getDefaultOrderData();
            }
        }

        // è·å–é»˜è®¤è®¢å•æ•°æ®ï¼ˆç”¨äºæ¼”ç¤ºï¼‰
        function getDefaultOrderData() {
            return {
                orderNo: 'HR20250122001',
                status: 'submitted',
                dealer: 'jxs-qx (é«˜çº§æ‰¹å‘å•†)',
                vehicleSeries: 'é¸¿æ—¥S1',
                vehicleModel: 'S1-23æ¬¾ç£·é…¸é“é”‚4kwå¿ƒåŠ¨ç‰ˆ',
                vehicleConfig: 'æ ‡é…',
                vehicleColor: 'çº¢è‰²',
                basePrice: 21900,
                additionalConfigs: [
                    { name: 'é”‚ç”µæ± +é”‚ç”µåŠ è£…æ‰‹å·¥è´¹', price: 4200 },
                    { name: 'æ–¹å‘åŠ©åŠ›', price: 680 }
                ],
                configTotal: 4880,
                otherFees: 1630,
                pickupMethod: 'ç‰©æµå‘è¿',
                pickupFee: 0,
                totalAmount: 28410,
                createdAt: '2025-01-22 14:30:25',
                submittedAt: '2025-01-22 14:30:25'
            };
        }

        // æ›´æ–°é¡µé¢å†…å®¹
        function updatePageContent() {
            if (!orderData) return;
            
            // æ›´æ–°è®¢å•å·
            const orderNoElements = document.querySelectorAll('[data-order-no]');
            orderNoElements.forEach(el => {
                el.textContent = orderData.orderNo;
            });
            
            // æ›´æ–°è½¦è¾†ä¿¡æ¯
            const vehicleSeriesEl = document.querySelector('[data-vehicle-series]');
            if (vehicleSeriesEl) vehicleSeriesEl.textContent = orderData.vehicleSeries;
            
            const vehicleModelEl = document.querySelector('[data-vehicle-model]');
            if (vehicleModelEl) vehicleModelEl.textContent = orderData.vehicleModel;
            
            const vehicleConfigEl = document.querySelector('[data-vehicle-config]');
            if (vehicleConfigEl) vehicleConfigEl.textContent = orderData.vehicleConfig;
            
            const vehicleColorEl = document.querySelector('[data-vehicle-color]');
            if (vehicleColorEl) vehicleColorEl.textContent = orderData.vehicleColor;
            
            // æ›´æ–°ä»·æ ¼ä¿¡æ¯
            const basePriceEl = document.querySelector('[data-base-price]');
            if (basePriceEl) basePriceEl.textContent = `Â¥${orderData.basePrice.toLocaleString()}`;
            
            const configTotalEl = document.querySelector('[data-config-total]');
            if (configTotalEl) configTotalEl.textContent = `Â¥${orderData.configTotal.toLocaleString()}`;
            
            const totalAmountEl = document.querySelector('[data-total-amount]');
            if (totalAmountEl) totalAmountEl.textContent = `Â¥${orderData.totalAmount.toLocaleString()}`;
            
            // æ›´æ–°æ—¶é—´ä¿¡æ¯
            const createdAtEl = document.querySelector('[data-created-at]');
            if (createdAtEl) createdAtEl.textContent = orderData.createdAt;
            
            const submittedAtEl = document.querySelector('[data-submitted-at]');
            if (submittedAtEl) submittedAtEl.textContent = orderData.submittedAt || 'å¾…æäº¤';
            
            // æ›´æ–°è®¢å•çŠ¶æ€æ˜¾ç¤º
            updateOrderStatusDisplay(orderData.status);
        }

        // åˆå§‹åŒ–è®¢å•è¯¦æƒ…é¡µé¢
        function initializeOrderDetail() {
            // æ ¹æ®è®¢å•çŠ¶æ€æ˜¾ç¤ºç›¸åº”çš„æ“ä½œæŒ‰é’®
            updateBottomActions(orderData.status);
        }

        // æ›´æ–°åº•éƒ¨æ“ä½œæŒ‰é’®
        function updateBottomActions(status) {
            const cancelBtn = document.getElementById('cancelOrderBtn');
            
            if (status === 'submitted') {
                // å·²æäº¤çŠ¶æ€ï¼šæ˜¾ç¤ºå–æ¶ˆè®¢å•æŒ‰é’®
                cancelBtn.style.display = 'flex';
                // ä¿®æ”¹è”ç³»å®¢æœæŒ‰é’®æ ·å¼ï¼Œä½¿å…¶ä¸å–æ¶ˆæŒ‰é’®å¹¶æ’æ˜¾ç¤º
                const contactBtn = document.querySelector('.btn-secondary');
                contactBtn.classList.remove('px-8');
                contactBtn.classList.add('flex-1');
            } else {
                // å…¶ä»–çŠ¶æ€ï¼šéšè—å–æ¶ˆè®¢å•æŒ‰é’®
                cancelBtn.style.display = 'none';
                // æ¢å¤è”ç³»å®¢æœæŒ‰é’®æ ·å¼
                const contactBtn = document.querySelector('.btn-secondary');
                contactBtn.classList.add('px-8');
                contactBtn.classList.remove('flex-1');
            }
        }

        // å–æ¶ˆè®¢å•åŠŸèƒ½
        function cancelOrder() {
            if (!orderData) {
                alert('è®¢å•æ•°æ®åŠ è½½å¤±è´¥ï¼Œæ— æ³•å–æ¶ˆè®¢å•');
                return;
            }
            
            const confirmMessage = `ç¡®è®¤è¦å–æ¶ˆè®¢å•å—ï¼Ÿ\n\nè®¢å•å·ï¼š${orderData.orderNo}\nè½¦å‹ï¼š${orderData.vehicleSeries} ${orderData.vehicleModel}\næ€»ä»·ï¼šÂ¥${orderData.totalAmount.toLocaleString()}\n\nå–æ¶ˆåè®¢å•å°†å˜ä¸ºå¾…æäº¤çŠ¶æ€ï¼Œæ‚¨å¯ä»¥é‡æ–°ç¼–è¾‘å’Œæäº¤ã€‚`;
            
            if (confirm(confirmMessage)) {
                try {
                    // æ›´æ–°è®¢å•çŠ¶æ€ä¸ºå¾…æäº¤
                    orderData.status = 'pending';
                    orderData.cancelledAt = new Date().toISOString();
                    
                    // æ›´æ–°localStorageä¸­çš„è®¢å•æ•°æ®
                    updateOrderInStorage(orderData);
                    
                    // æ›´æ–°é¡µé¢æ˜¾ç¤º
                    updateOrderStatusDisplay('pending');
                    
                    // æ›´æ–°åº•éƒ¨æ“ä½œæŒ‰é’®
                    updateBottomActions('pending');
                    
                    alert('è®¢å•å·²æˆåŠŸå–æ¶ˆï¼\n\nè®¢å•çŠ¶æ€å·²å˜ä¸ºå¾…æäº¤ï¼Œæ‚¨å¯ä»¥åœ¨è®¢å•åˆ—è¡¨ä¸­é‡æ–°ç¼–è¾‘å’Œæäº¤æ­¤è®¢å•ã€‚');
                    
                    // æ·»åŠ ä¸€ä¸ªçŸ­æš‚å»¶è¿Ÿï¼Œç„¶åè·³è½¬åˆ°ordersé¡µé¢å¹¶å¼ºåˆ¶åˆ·æ–°
                    setTimeout(() => {
                        // ä½¿ç”¨location.replaceè€Œä¸æ˜¯hrefï¼Œé¿å…æµè§ˆå™¨ç¼“å­˜
                        window.location.replace('orders.html?refresh=' + Date.now());
                    }, 1000);
                    
                } catch (error) {
                    console.error('å–æ¶ˆè®¢å•å¤±è´¥:', error);
                    alert('å–æ¶ˆè®¢å•å¤±è´¥ï¼Œè¯·é‡è¯•');
                }
            }
        }

        // æ›´æ–°localStorageä¸­çš„è®¢å•æ•°æ®
        function updateOrderInStorage(updatedOrder) {
            try {
                // è·å–ç°æœ‰è®¢å•åˆ—è¡¨
                let orders = JSON.parse(localStorage.getItem('dealerOrders') || '[]');
                
                // æ‰¾åˆ°å¹¶æ›´æ–°å¯¹åº”çš„è®¢å•
                const orderIndex = orders.findIndex(order => order.orderNo === updatedOrder.orderNo);
                
                if (orderIndex !== -1) {
                    orders[orderIndex] = { ...orders[orderIndex], ...updatedOrder };
                    orders[orderIndex].updatedAt = new Date().toISOString();
                    
                    // ä¿å­˜å›localStorage
                    localStorage.setItem('dealerOrders', JSON.stringify(orders));
                    
                    console.log('è®¢å•çŠ¶æ€å·²æ›´æ–°:', updatedOrder);
                } else {
                    console.warn('æœªæ‰¾åˆ°å¯¹åº”çš„è®¢å•:', updatedOrder.orderNo);
                }
            } catch (error) {
                console.error('æ›´æ–°è®¢å•å¤±è´¥:', error);
                throw error;
            }
        }

        // æ›´æ–°é¡µé¢ä¸Šçš„è®¢å•çŠ¶æ€æ˜¾ç¤º
        function updateOrderStatusDisplay(status) {
            const statusMap = {
                'pending': 'å¾…æäº¤',
                'submitted': 'å·²æäº¤å¾…ç¡®è®¤è°ƒè½¦',
                'confirmed': 'å·²ç¡®è®¤è°ƒè½¦',
                'shipped': 'å·²å‘è´§',
                'completed': 'å·²å®Œæˆ'
            };
            
            // æ›´æ–°çŠ¶æ€æ ‡é¢˜
            const statusTitle = document.querySelector('.status-header .text-lg');
            if (statusTitle) {
                statusTitle.textContent = `ğŸš— ${statusMap[status] || 'æœªçŸ¥çŠ¶æ€'}`;
            }
            
            // æ›´æ–°çŠ¶æ€æµç¨‹æ˜¾ç¤º
            updateStatusSteps(status);
        }

        // æ›´æ–°çŠ¶æ€æµç¨‹æ˜¾ç¤º
        function updateStatusSteps(status) {
            const steps = document.querySelectorAll('.status-step');
            
            // é‡ç½®æ‰€æœ‰æ­¥éª¤çŠ¶æ€
            steps.forEach(step => {
                step.classList.remove('completed', 'current');
                const icon = step.querySelector('.status-icon');
                const text = step.querySelector('.font-medium');
                const time = step.querySelector('.text-sm');
                
                icon.classList.remove('completed', 'current');
                icon.classList.add('bg-gray-200');
                text.classList.add('text-gray-400');
                time.classList.add('text-gray-400');
            });
            
            // æ ¹æ®çŠ¶æ€æ›´æ–°æ­¥éª¤æ˜¾ç¤º
            if (status === 'pending') {
                // å¾…æäº¤çŠ¶æ€ï¼šåªæœ‰ç¬¬ä¸€æ­¥æ˜¯å½“å‰çŠ¶æ€
                const firstStep = steps[0];
                if (firstStep) {
                    const icon = firstStep.querySelector('.status-icon');
                    const text = firstStep.querySelector('.font-medium');
                    const time = firstStep.querySelector('.text-sm');
                    
                    firstStep.classList.add('current');
                    icon.classList.remove('completed', 'bg-gray-200');
                    icon.classList.add('current');
                    text.classList.remove('text-gray-400');
                    text.textContent = 'è®¢å•å¾…æäº¤';
                    time.classList.remove('text-gray-400');
                    time.textContent = 'å¯é‡æ–°ç¼–è¾‘æäº¤';
                }
            } else if (status === 'submitted') {
                // å·²æäº¤çŠ¶æ€ï¼šç¬¬ä¸€æ­¥å®Œæˆï¼Œç¬¬äºŒæ­¥å½“å‰
                const firstStep = steps[0];
                const secondStep = steps[1];
                
                if (firstStep) {
                    firstStep.classList.add('completed');
                    const icon = firstStep.querySelector('.status-icon');
                    icon.classList.remove('current', 'bg-gray-200');
                    icon.classList.add('completed');
                }
                
                if (secondStep) {
                    secondStep.classList.add('current');
                    const icon = secondStep.querySelector('.status-icon');
                    icon.classList.remove('completed', 'bg-gray-200');
                    icon.classList.add('current');
                }
            }
        }

        function goBack() {
            // æ·»åŠ refreshå‚æ•°ï¼Œç¡®ä¿ordersé¡µé¢é‡æ–°åŠ è½½æ•°æ®
            window.location.href = 'orders.html?refresh=' + Date.now();
        }
    </script>
</body>
</html> 