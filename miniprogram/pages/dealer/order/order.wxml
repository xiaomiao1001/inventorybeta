<!-- Tabå¯¼èˆª -->
<view class="tab-nav">
  <view class="tab-item active">ä¸‹å•</view>
  <view class="tab-item" bindtap="switchToOrders">è®¢å•</view>
</view>

<!-- ä»·æ ¼å¤„ç†çš„WXS -->
<wxs module="utils">
  var abs = function(num) {
    return num < 0 ? -num : num;
  };
  
  module.exports = {
    abs: abs
  };
</wxs>

<!-- åŠ è½½çŠ¶æ€ -->
<view class="loading-overlay" wx:if="{{isLoadingInventory}}">
  <view class="loading-content">
    <view class="loading-spinner"></view>
    <text class="loading-text">æ­£åœ¨åŠ è½½è½¦å‹æ•°æ®...</text>
  </view>
</view>

<!-- ä¸»è¦å†…å®¹ -->
<scroll-view scroll-y class="main-content">
  <!-- ç¬¬ä¸€éƒ¨åˆ†ï¼šé…ç½®è½¦è¾† -->
  <view class="form-section">
    <view class="section-header">
      <view class="section-title">
        <text class="icon">ğŸš—</text>
        <text>é…ç½®è½¦è¾†</text>
      </view>
    </view>
    
    <view class="form-content">
      <!-- ç»é”€å•†ä¿¡æ¯ -->
      <view class="form-item">
        <text class="label">ç»é”€å•†</text>
        <text class="value">{{dealerInfo}}</text>
      </view>

      <!-- è½¦å‹ç³»åˆ— -->
      <view class="form-item" bindtap="showSeriesPicker">
        <text class="label">è½¦å‹ç³»åˆ—</text>
        <view class="picker-display">
          <text class="picker-text {{selectedSeries ? '' : 'placeholder'}}">
            {{selectedSeries || 'è¯·é€‰æ‹©è½¦å‹ç³»åˆ—'}}
          </text>
          <text class="picker-arrow">â€º</text>
        </view>
      </view>

      <!-- è½¦å‹ -->
      <view class="form-item" bindtap="showModelPicker">
        <text class="label">è½¦å‹</text>
        <view class="picker-display">
          <text class="picker-text {{selectedModel ? '' : 'placeholder'}}">
            {{selectedModel || 'è¯·é€‰æ‹©è½¦å‹'}}
          </text>
          <text class="picker-arrow">â€º</text>
        </view>
      </view>

      <!-- é…ç½®ä¿¡æ¯ -->
      <view class="form-item" bindtap="showConfigPicker">
        <text class="label">é…ç½®</text>
        <view class="picker-display">
          <text class="picker-text {{selectedConfig ? '' : 'placeholder'}}">
            {{selectedConfig || 'è¯·é€‰æ‹©é…ç½®'}}
          </text>
          <text class="picker-arrow">â€º</text>
        </view>
      </view>

      <!-- é¢œè‰² -->
      <view class="form-item" bindtap="showColorPicker">
        <text class="label">é¢œè‰²</text>
        <view class="picker-display">
          <view class="color-display" wx:if="{{selectedColor}}">
            <view class="color-dot" style="background-color: {{selectedColorCode}};"></view>
            <text class="picker-text">{{selectedColor}}</text>
          </view>
          <text class="picker-text placeholder" wx:else>è¯·é€‰æ‹©é¢œè‰²</text>
          <text class="picker-arrow">â€º</text>
        </view>
      </view>

      <!-- åŸºç¡€ä»·æ ¼ -->
      <view class="form-item">
        <text class="label">åŸºç¡€ä»·æ ¼</text>
        <view class="price-tag">Â¥{{basePrice}}</view>
      </view>
    </view>
  </view>

  <!-- ç¬¬äºŒéƒ¨åˆ†ï¼šå¢åŠ é…ç½® -->
  <view class="form-section">
    <view class="section-header">
      <view class="section-title">
        <text class="icon">â•</text>
        <text>å¢åŠ é…ç½®</text>
      </view>
    </view>
    
    <view class="form-content">
      <view class="config-list">
        <view 
          class="config-item {{item.selected ? 'selected' : ''}}" 
          wx:for="{{configOptions}}" 
          wx:key="id"
          bindtap="toggleConfig"
          data-index="{{index}}"
        >
          <view class="config-content">
            <view class="config-left">
              <text class="config-icon">{{item.selected ? 'âœ“' : 'â—‹'}}</text>
              <view class="config-info">
                <text class="config-name">{{item.name}}</text>
                <text class="config-desc" wx:if="{{item.desc}}">{{item.desc}}</text>
              </view>
            </view>
            <view class="config-price {{item.price < 0 ? 'negative' : ''}}">
              {{item.price < 0 ? '-Â¥' + utils.abs(item.price) : 'Â¥' + item.price}}
            </view>
          </view>
        </view>
      </view>

      <!-- é…ç½®å°è®¡ -->
      <view class="config-total">
        <view class="total-row">
          <text class="total-label">é…ç½®å°è®¡</text>
          <text class="total-price">Â¥{{configTotalPrice}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç¬¬ä¸‰éƒ¨åˆ†ï¼šå…¶ä»–è´¹ç”¨ -->
  <view class="form-section">
    <view class="section-header">
      <view class="section-title">
        <text class="icon">ğŸ§®</text>
        <text>å…¶ä»–è´¹ç”¨</text>
      </view>
    </view>
    
    <view class="form-content">
      <view class="form-item">
        <text class="label">ä¿é™©+è£…è½¦è´¹</text>
        <text class="value">Â¥{{otherFees.insurance}}</text>
      </view>
      <view class="form-item">
        <text class="label">è¿è´¹</text>
        <text class="value">Â¥{{otherFees.shipping}}</text>
      </view>
      <view class="form-item">
        <text class="label">åŠ ä»·</text>
        <text class="value">Â¥{{otherFees.markup}}</text>
      </view>
      <view class="form-item">
        <text class="label">å¥–åŠ±æ ¸å‡</text>
        <text class="value">Â¥{{otherFees.discount}}</text>
      </view>
    </view>
  </view>

  <!-- ç¬¬å››éƒ¨åˆ†ï¼šæè½¦æ–¹å¼ -->
  <view class="form-section">
    <view class="section-header">
      <view class="section-title">
        <text class="icon">ğŸšš</text>
        <text>æè½¦æ–¹å¼</text>
      </view>
    </view>
    
    <view class="form-content">
      <view class="pickup-options">
        <view 
          class="pickup-item {{deliveryMethod === item.value ? 'selected' : ''}}"
          wx:for="{{deliveryOptions}}" 
          wx:key="value"
          bindtap="selectDeliveryMethod"
          data-value="{{item.value}}"
        >
          <view class="pickup-content">
            <view class="pickup-left">
              <text class="pickup-icon">{{deliveryMethod === item.value ? 'â—' : 'â—‹'}}</text>
              <text class="pickup-name">{{item.name}}</text>
            </view>
            <text class="pickup-fee">{{item.fee === 0 ? 'å…è´¹' : 'Â¥' + item.fee}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ€»ä»·è®¡ç®— -->
  <view class="total-section">
    <view class="total-breakdown">
      <view class="breakdown-item">
        <text class="breakdown-label">åŸºç¡€ä»·æ ¼</text>
        <text class="breakdown-value">Â¥{{basePrice}}</text>
      </view>
      <view class="breakdown-item">
        <text class="breakdown-label">å¢åŠ é…ç½®</text>
        <text class="breakdown-value">+Â¥{{configTotalPrice}}</text>
      </view>
      <view class="breakdown-item">
        <text class="breakdown-label">å…¶ä»–è´¹ç”¨</text>
        <text class="breakdown-value">+Â¥{{otherFeesTotalPrice}}</text>
      </view>
      <view class="breakdown-item">
        <text class="breakdown-label">æè½¦æœåŠ¡è´¹</text>
        <text class="breakdown-value">+Â¥{{deliveryFee}}</text>
      </view>
    </view>
    <view class="total-final">
      <text class="total-label">è®¢å•æ€»é¢</text>
      <text class="total-amount">Â¥{{totalAmount}}</text>
    </view>
  </view>
</scroll-view>

<!-- åº•éƒ¨æ“ä½œæ  -->
<view class="bottom-actions">
  <button class="btn btn-secondary" bindtap="addToCart">åŠ å…¥è´­ç‰©è½¦</button>
  <button class="btn btn-primary" bindtap="submitOrder">æäº¤è®¢å•</button>
</view>

<!-- é€‰æ‹©å™¨å¼¹çª— -->
<view class="picker-modal {{showPicker ? 'show' : ''}}" bindtap="hidePicker">
  <view class="picker-content" catchtap="stopPropagation">
    <view class="picker-header">
      <text class="picker-title">{{pickerTitle}}</text>
      <text class="picker-close" bindtap="hidePicker">âœ•</text>
    </view>
    <scroll-view scroll-y class="picker-list">
      <view 
        class="picker-option {{currentPickerValue === item.value ? 'selected' : ''}}"
        wx:for="{{pickerOptions}}" 
        wx:key="value"
        bindtap="selectPickerOption"
        data-value="{{item.value}}"
        data-label="{{item.label}}"
        data-data="{{item}}"
      >
        <text class="option-text">{{item.label}}</text>
        <text class="option-check" wx:if="{{currentPickerValue === item.value}}">âœ“</text>
      </view>
    </scroll-view>
  </view>
</view> 