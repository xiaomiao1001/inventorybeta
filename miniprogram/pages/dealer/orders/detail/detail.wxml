<!-- è®¢å•çŠ¶æ€å¤´éƒ¨ -->
<view class="status-header">
  <view class="status-info">
    <text class="status-emoji">{{getStatusEmoji(orderDetail.status)}}</text>
    <text class="status-text">{{getStatusText(orderDetail.status)}}</text>
    <text class="order-no">è®¢å•å·: {{orderDetail.orderNo}}</text>
  </view>
  <view class="estimate-time" wx:if="{{orderDetail.status === 'submitted'}}">
    <text class="estimate-label">é¢„è®¡å¤„ç†æ—¶é—´</text>
    <text class="estimate-value">1-2ä¸ªå·¥ä½œæ—¥</text>
  </view>
</view>

<!-- çŠ¶æ€æµç¨‹ -->
<view class="status-timeline">
  <view class="timeline-item {{getTimelineStatus('submitted', orderDetail.status)}}">
    <view class="timeline-icon">
      <text class="icon-text">{{getTimelineStatus('submitted', orderDetail.status) === 'completed' ? 'âœ“' : 'â—'}}</text>
    </view>
    <view class="timeline-content">
      <text class="timeline-title">è®¢å•å·²æäº¤</text>
      <text class="timeline-time">{{orderDetail.createdAt ? formatTime(orderDetail.createdAt) : ''}}</text>
    </view>
  </view>

  <view class="timeline-item {{getTimelineStatus('confirmed', orderDetail.status)}}">
    <view class="timeline-icon">
      <text class="icon-text">{{getTimelineStatus('confirmed', orderDetail.status) === 'completed' ? 'âœ“' : getTimelineStatus('confirmed', orderDetail.status) === 'current' ? 'â°' : 'â—'}}</text>
    </view>
    <view class="timeline-content">
      <text class="timeline-title">ç­‰å¾…ç¡®è®¤è°ƒè½¦</text>
      <text class="timeline-time">{{orderDetail.status === 'submitted' ? 'é¢„è®¡ä»Šæ—¥å¤„ç†' : ''}}</text>
    </view>
  </view>

  <view class="timeline-item {{getTimelineStatus('shipped', orderDetail.status)}}">
    <view class="timeline-icon">
      <text class="icon-text">{{getTimelineStatus('shipped', orderDetail.status) === 'completed' ? 'âœ“' : 'â—'}}</text>
    </view>
    <view class="timeline-content">
      <text class="timeline-title">å‡†å¤‡å‘è´§</text>
      <text class="timeline-time">{{getTimelineStatus('shipped', orderDetail.status) === 'pending' ? 'ç­‰å¾…ä¸Šä¸€æ­¥å®Œæˆ' : ''}}</text>
    </view>
  </view>

  <view class="timeline-item {{getTimelineStatus('completed', orderDetail.status)}}">
    <view class="timeline-icon">
      <text class="icon-text">{{getTimelineStatus('completed', orderDetail.status) === 'completed' ? 'âœ“' : 'â—'}}</text>
    </view>
    <view class="timeline-content">
      <text class="timeline-title">è®¢å•å®Œæˆ</text>
      <text class="timeline-time">{{getTimelineStatus('completed', orderDetail.status) === 'pending' ? 'ç­‰å¾…ä¸Šä¸€æ­¥å®Œæˆ' : ''}}</text>
    </view>
  </view>
</view>

<!-- ä¸»è¦å†…å®¹ -->
<scroll-view scroll-y class="detail-content">
  <!-- è½¦è¾†ä¿¡æ¯ -->
  <view class="detail-section">
    <view class="section-header">
      <text class="section-title">ğŸš— è½¦è¾†ä¿¡æ¯</text>
    </view>
    
    <view class="section-content">
      <view class="info-row">
        <text class="info-label">ç»é”€å•†</text>
        <text class="info-value">{{orderDetail.dealer}}</text>
      </view>
      <view class="info-row">
        <text class="info-label">è½¦å‹ç³»åˆ—</text>
        <text class="info-value">{{orderDetail.vehicleSeries}}</text>
      </view>
      <view class="info-row">
        <text class="info-label">è½¦å‹</text>
        <text class="info-value">{{orderDetail.vehicleModel}}</text>
      </view>
      <view class="info-row">
        <text class="info-label">é…ç½®</text>
        <text class="info-value">{{orderDetail.vehicleConfig}}</text>
      </view>
      <view class="info-row">
        <text class="info-label">é¢œè‰²</text>
        <view class="color-display">
          <view class="color-dot" style="background-color: {{getColorCode(orderDetail.vehicleColor)}};"></view>
          <text class="info-value">{{orderDetail.vehicleColor}}</text>
        </view>
      </view>
      <view class="info-row">
        <text class="info-label">åŸºç¡€ä»·æ ¼</text>
        <view class="price-highlight">Â¥{{orderDetail.basePrice}}</view>
      </view>
    </view>
  </view>

  <!-- å¢åŠ é…ç½® -->
  <view class="detail-section" wx:if="{{orderDetail.additionalConfigs && orderDetail.additionalConfigs.length > 0}}">
    <view class="section-header">
      <text class="section-title">â• å¢åŠ é…ç½®</text>
    </view>
    
    <view class="section-content">
      <view class="info-row" wx:for="{{orderDetail.additionalConfigs}}" wx:key="id">
        <text class="info-label">{{item.name}}</text>
        <view class="price-highlight {{item.price < 0 ? 'negative' : ''}}">
          {{item.price < 0 ? '-' : ''}}Â¥{{Math.abs(item.price)}}
        </view>
      </view>
      <view class="info-row total-row">
        <text class="info-label total-label">é…ç½®å°è®¡</text>
        <text class="total-price">Â¥{{orderDetail.configTotalPrice}}</text>
      </view>
    </view>
  </view>

  <!-- å…¶ä»–è´¹ç”¨ -->
  <view class="detail-section" wx:if="{{orderDetail.otherFeesTotalPrice > 0}}">
    <view class="section-header">
      <text class="section-title">ğŸ§® å…¶ä»–è´¹ç”¨</text>
    </view>
    
    <view class="section-content">
      <view class="info-row" wx:if="{{orderDetail.otherFees.insurance > 0}}">
        <text class="info-label">ä¿é™©+è£…è½¦è´¹</text>
        <text class="info-value">Â¥{{orderDetail.otherFees.insurance}}</text>
      </view>
      <view class="info-row" wx:if="{{orderDetail.otherFees.shipping > 0}}">
        <text class="info-label">è¿è´¹</text>
        <text class="info-value">Â¥{{orderDetail.otherFees.shipping}}</text>
      </view>
      <view class="info-row" wx:if="{{orderDetail.otherFees.markup > 0}}">
        <text class="info-label">åŠ ä»·</text>
        <text class="info-value">Â¥{{orderDetail.otherFees.markup}}</text>
      </view>
      <view class="info-row" wx:if="{{orderDetail.otherFees.discount > 0}}">
        <text class="info-label">å¥–åŠ±æ ¸å‡</text>
        <text class="info-value">Â¥{{orderDetail.otherFees.discount}}</text>
      </view>
      <view class="info-row total-row">
        <text class="info-label total-label">è´¹ç”¨å°è®¡</text>
        <text class="total-price">Â¥{{orderDetail.otherFeesTotalPrice}}</text>
      </view>
    </view>
  </view>

  <!-- æè½¦æ–¹å¼ -->
  <view class="detail-section">
    <view class="section-header">
      <text class="section-title">ğŸšš æè½¦æ–¹å¼</text>
    </view>
    
    <view class="section-content">
      <view class="info-row">
        <text class="info-label">æè½¦æ–¹å¼</text>
        <text class="info-value">{{getDeliveryMethodText(orderDetail.deliveryMethod)}}</text>
      </view>
      <view class="info-row">
        <text class="info-label">æœåŠ¡è´¹ç”¨</text>
        <text class="info-value {{orderDetail.deliveryFee === 0 ? 'free' : ''}}">
          {{orderDetail.deliveryFee === 0 ? 'å…è´¹' : 'Â¥' + orderDetail.deliveryFee}}
        </text>
      </view>
    </view>
  </view>

  <!-- è®¢å•é‡‘é¢æ±‡æ€» -->
  <view class="total-summary">
    <view class="summary-breakdown">
      <view class="breakdown-item">
        <text class="breakdown-label">åŸºç¡€ä»·æ ¼</text>
        <text class="breakdown-value">Â¥{{orderDetail.basePrice}}</text>
      </view>
      <view class="breakdown-item" wx:if="{{orderDetail.configTotalPrice > 0}}">
        <text class="breakdown-label">å¢åŠ é…ç½®</text>
        <text class="breakdown-value">+Â¥{{orderDetail.configTotalPrice}}</text>
      </view>
      <view class="breakdown-item" wx:if="{{orderDetail.otherFeesTotalPrice > 0}}">
        <text class="breakdown-label">å…¶ä»–è´¹ç”¨</text>
        <text class="breakdown-value">+Â¥{{orderDetail.otherFeesTotalPrice}}</text>
      </view>
      <view class="breakdown-item" wx:if="{{orderDetail.deliveryFee > 0}}">
        <text class="breakdown-label">æè½¦æœåŠ¡è´¹</text>
        <text class="breakdown-value">+Â¥{{orderDetail.deliveryFee}}</text>
      </view>
    </view>
    <view class="final-total">
      <text class="total-label">è®¢å•æ€»é¢</text>
      <text class="total-amount">Â¥{{orderDetail.totalAmount}}</text>
    </view>
  </view>

  <!-- è®¢å•ä¿¡æ¯ -->
  <view class="detail-section">
    <view class="section-header">
      <text class="section-title">â„¹ï¸ è®¢å•ä¿¡æ¯</text>
    </view>
    
    <view class="section-content">
      <view class="info-row">
        <text class="info-label">è®¢å•å·</text>
        <text class="info-value">{{orderDetail.orderNo}}</text>
      </view>
      <view class="info-row">
        <text class="info-label">ä¸‹å•æ—¶é—´</text>
        <text class="info-value">{{formatTime(orderDetail.createdAt)}}</text>
      </view>
      <view class="info-row" wx:if="{{orderDetail.status !== 'pending'}}">
        <text class="info-label">æäº¤æ—¶é—´</text>
        <text class="info-value">{{formatTime(orderDetail.updatedAt)}}</text>
      </view>
      <view class="info-row" wx:if="{{orderDetail.status === 'confirmed' || orderDetail.status === 'shipped' || orderDetail.status === 'completed'}}">
        <text class="info-label">ç¡®è®¤æ—¶é—´</text>
        <text class="info-value">å¾…ç¡®è®¤</text>
      </view>
      <view class="info-row" wx:if="{{orderDetail.status === 'shipped' || orderDetail.status === 'completed'}}">
        <text class="info-label">å‘è´§æ—¶é—´</text>
        <text class="info-value">å¾…å‘è´§</text>
      </view>
    </view>
  </view>
</scroll-view>

<!-- åº•éƒ¨æ“ä½œæ  -->
<view class="bottom-actions" wx:if="{{orderDetail.status === 'pending'}}">
  <button class="action-btn edit-btn" bindtap="editOrder">ç¼–è¾‘è®¢å•</button>
  <button class="action-btn submit-btn" bindtap="submitOrder">æäº¤è®¢å•</button>
</view>

<!-- åŠ è½½çŠ¶æ€ -->
<view class="loading-overlay" wx:if="{{loading}}">
  <view class="loading-content">
    <view class="loading-icon">â³</view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>
</view> 