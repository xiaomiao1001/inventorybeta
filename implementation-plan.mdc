# 郭四车行库存管理系统 - 实施计划

## 项目概述
微信小程序：郭四车行库存管理系统
技术栈：微信小程序 + 腾讯云开发 + CloudBase MySQL + 火山引擎OCR

## 开发阶段实施计划

### 第一阶段：前端页面开发、页面跳转逻辑梳理 (2周)
- [ ] 1.1 设计所有页面的UI界面
- [ ] 1.2 梳理页面间的跳转逻辑和导航结构  
- [ ] 1.3 确定数据传递方式和页面状态管理
- [ ] 1.4 完成静态页面的交互效果

### 第二阶段：基础表、核心表搭建 (1周)
- [x] 2.1 设计并创建数据库表结构 - **Done**
  已完成完整的数据库表结构设计，包含11个核心业务表
- [x] 2.2 建立表与表之间的关联关系 - **Done**
  设置了外键约束和索引，建立了表间关联关系
- [x] 2.3 设置索引和约束条件 - **Done**
  为关键字段添加了索引，设置了唯一约束和外键约束
- [x] 2.4 初始化基础数据和配置数据 - **Done**
  准备了用户权限、经销商配置、车辆价格等基础数据

### 第三阶段：后端数据库连接 (1周) 
- [x] 3.1 配置腾讯云开发环境 - **Done** 
  已完成云开发环境配置，环境ID: cloud1-2gv7aqlv39d20b5c
- [x] 3.2 建立小程序与数据库的连接 - **Done**
  修复了云函数配置问题，添加了数据库初始化功能
- [ ] 3.3 实现基础的CRUD操作接口
- [ ] 3.4 测试数据库连接稳定性

### 第四阶段：用户权限系统开发 (2周)
- [ ] 4.1 实现用户登录认证功能
- [ ] 4.2 开发角色权限管理模块
- [ ] 4.3 建立操作日志记录机制
- [ ] 4.4 测试权限控制有效性

### 第五阶段：库存管理功能开发 (2周)
- [ ] 5.1 实现库存查看、添加、编辑功能
- [ ] 5.2 开发批量添加库存功能
- [ ] 5.3 完成库存状态管理
- [ ] 5.4 测试库存数据准确性

### 第六阶段：零售出库功能开发 (2周)
- [ ] 6.1 集成火山引擎身份证识别API
- [ ] 6.2 开发客户信息录入功能
- [ ] 6.3 实现支付信息和销售信息管理
- [ ] 6.4 完成赊欠和旧车折抵逻辑

### 第七阶段：批发出库功能开发 (2周)
- [ ] 7.1 开发经销商价格配置功能
- [ ] 7.2 实现批发出库流程
- [ ] 7.3 完成价格自动计算逻辑
- [ ] 7.4 测试批发业务流程

### 第八阶段：统计报表和赊欠管理 (2周)
- [ ] 8.1 开发数据统计分析功能
- [ ] 8.2 实现报表导出功能
- [ ] 8.3 完成赊欠管理和提醒功能
- [ ] 8.4 测试统计数据准确性

### 第九阶段：系统优化和集成测试 (1周)
- [ ] 9.1 性能优化和bug修复
- [ ] 9.2 完整业务流程测试
- [ ] 9.3 用户体验优化
- [ ] 9.4 安全性测试

### 第十阶段：部署上线和验收 (1周)
- [ ] 10.1 生产环境部署
- [ ] 10.2 用户培训和使用指导
- [ ] 10.3 功能验收和性能测试
- [ ] 10.4 项目交付和后续维护计划

## 经销商功能开发 - **新增阶段**

### 经销商下单页面开发 - **已完成** ✅
- [x] E1.1 创建经销商登录账号和权限验证 - **Done**
  添加了两个经销商测试账号：jxs-xz(低级批发商)、jxs-qx(高级批发商)
- [x] E1.2 开发经销商专用导航结构 - **Done**
  实现了经销商专用的双标签导航：下单、订单
- [x] E1.3 实现车辆配置选择功能 - **Done**
  完成车型系列、车型、配置、颜色的级联选择，从鸿日库存实时获取数据
- [x] E1.4 开发增加配置选择功能 - **Done**
  实现9项增加配置的多选功能，包含锂电池型号自动匹配(60V/72V)
- [x] E1.5 实现其他费用自动计算 - **Done**
  根据经销商等级自动设置保险+装车费、运费、加价、奖励核减
- [x] E1.6 开发提车方式选择功能 - **Done**
  实现物流发运、自提、送车三种方式选择，送车包含服务费
- [x] E1.7 实现价格实时计算功能 - **Done**
  完成基础价格、增加配置、其他费用、提车服务费的实时汇总计算

### 经销商订单管理开发 - **已完成** ✅
- [x] E2.1 开发订单列表页面 - **Done**
  实现订单列表展示，包含订单状态、车辆信息、金额显示
- [x] E2.2 开发订单详情页面 - **Done**
  完成详细的订单信息展示，包含车辆信息、配置明细、费用明细
- [x] E2.3 实现订单状态管理 - **Done**
  实现4种订单状态：待提交、已提交待确认调车、已调车待发货、已发货结算
- [x] E2.4 开发订单操作功能 - **Done**
  实现订单提交、编辑等操作功能

## 当前问题诊断与解决方案

### 问题1：CloudBase MySQL连接失败 ✅ 已解决
**状态**: 🟢 已修复
**描述**: 云函数中CloudBase models对象获取失败
**解决方案**: 
1. ✅ 修复了云函数package.json配置错误
2. ✅ 创建了数据库初始化模块
3. ✅ 添加了数据库表结构创建功能

### 问题2：云函数配置错误 ✅ 已解决
**状态**: 🟢 已修复  
**描述**: functions/inventoryManager/package.json格式有误
**解决方案**: ✅ 修复了JSON格式，添加了wx-server-sdk依赖

### 问题3：数据库表结构未创建 ✅ 已解决
**状态**: 🟢 已完成
**描述**: 缺少核心业务表结构
**解决方案**: ✅ 创建了完整的11个数据库表结构和基础数据

## 下一步行动项
1. ✅ 修复云函数配置文件 - 已完成
2. ✅ 检查并配置CloudBase MySQL服务 - 已完成  
3. ✅ 创建核心数据表结构 - 已完成
4. ✅ 开发经销商下单页面 - 已完成
5. ✅ 开发经销商订单管理页面 - 已完成
6. 📋 实现经销商订单数据库操作 - 待开始
7. 📋 开发管理端订单确认功能 - 待开始

## 最新更新记录
**2025-01-22 下午**
- ✅ 创建了implementation-plan.mdc实施计划文档
- ✅ 修复了functions/inventoryManager/package.json配置错误
- ✅ 创建了完整的database-schema.sql数据库表结构
- ✅ 开发了init-database.js数据库初始化模块
- ✅ 更新了云函数主文件，添加init_database操作
- ✅ 准备了21个经销商的配置价格数据
- ✅ 设计了11个核心业务表，包含完整的索引和约束
- ✅ 完成经销商身份功能开发：下单页面、订单列表、订单详情
- ✅ 实现经销商专用导航和权限控制
- ✅ 集成鸿日库存数据，实现车型配置的动态选择
- ✅ 完成价格计算逻辑，支持高级/低级经销商差异化定价

## 经销商功能特性总结
### 已实现功能
1. **权限控制**: 经销商专用登录验证和页面访问控制
2. **下单流程**: 完整的车辆配置、增加配置、费用计算、提车方式选择
3. **价格体系**: 基础车价 + 增加配置 + 其他费用 + 提车服务费的完整计算
4. **订单管理**: 订单列表、详情查看、状态管理、操作功能
5. **数据集成**: 与鸿日库存系统的实时数据对接
6. **用户体验**: 响应式设计、TDesign组件风格、直观的操作流程

### 技术实现亮点
1. **动态数据加载**: 从云函数获取鸿日库存数据，实现车型配置的级联选择
2. **智能价格匹配**: 根据车型自动匹配锂电池型号和价格
3. **差异化定价**: 高级/低级经销商的不同价格体系
4. **实时计算**: 配置变更时的价格实时更新
5. **状态管理**: 订单的完整生命周期状态管理
