# 郭四车行库存管理系统 - 经销商功能需求文档

## 项目概述

### 项目背景
郭四车行库存管理系统是一个基于微信小程序的车辆库存管理平台，采用微信小程序 + 腾讯云开发 + CloudBase MySQL + 火山引擎OCR的技术栈。系统已具备基础的库存管理、用户权限等功能。

### 新增需求
为系统新增"经销商"身份功能，为经销商用户提供专门的下单和订单管理功能。

## 经销商角色定义

### 经销商等级分类
1. **低级批发商（乡镇经销商）**
   - 用户名：`jxs-xz`
   - 密码：`123456`
   - 对应地区：乡镇地区
   - 价格策略：使用价格表第二列（low价格）
   - 费用策略：所有附加费用为0

2. **高级批发商（旗县经销商）**
   - 用户名：`jxs-qx`
   - 密码：`123456`
   - 对应地区：旗县地区
   - 价格策略：使用价格表第一列（high价格）
   - 费用策略：包含各项附加费用

## 功能模块详细需求

### 1. 经销商下单页面 (`pages/dealer/order/order`)

#### 1.1 页面结构
- **导航栏**：包含"下单"和"订单"两个标签
- **页面内容**：分为三个主要部分的表单

#### 1.2 第一部分：配置车辆



#### 1.3 第二部分：增加配置（多选）
##### 基本信息
- **经销商信息**：自动填入当前登录的经销商用户名
- **车型系列选择**：下拉菜单，从鸿日库存实时获取可选系列
- **车型选择**：下拉菜单，根据选择的系列动态加载车型
- **配置信息**：根据选择的车型自动填入配置信息
- **颜色选择**：下拉菜单，根据选择的车型动态加载可选颜色

##### 数据来源
- 车型和颜色数据从鸿日库存实时获取
- 只显示库存状态为"在库"的车辆
- 支持级联选择：系列 → 车型 → 配置 → 颜色
##### 配置选项及价格
1. **锂电池+锂电加装手工费**
   - 60V车型（小功率）：¥4,200（3900+300）
   - 72V车型（其他）：¥4,600（4300+300）
   - 自动判断车型功率

2. **铅酸电池折抵**：¥-3,120
3. **方向助力**：¥680
4. **增程器**：¥1,400
5. **柴暖**：¥400
6. **铝轮**：¥720
7. **坐垫**：¥100
8. **脚垫**：¥50
9. **轮毂盖**：¥50

##### 功能特性
- 支持多选配置
- 实时计算配置总价
- 根据车型自动设置锂电池价格

#### 1.4 第三部分：其他费用

##### 费用项目
1. **保险+装车费**
   - 高级批发商：¥80
   - 低级批发商：¥0

2. **运费**
   - 高级批发商：¥1,100-1,200（根据地区）
   - 低级批发商：¥0

3. **加价**
   - 高级批发商：¥300-500（根据地区）
   - 低级批发商：¥0

4. **奖励核减**
   - 所有经销商：¥0

##### 自动计算规则
- 根据经销商等级自动判断费用
- 实时计算其他费用总价

#### 1.5 第四部分：提车方式

##### 提车选项
1. **物流发运**：免费
2. **自提**：免费
3. **送车**：需额外支付送车服务费¥150

##### 功能要求
- 单选或多选（根据业务需求）
- 选择送车时自动加入服务费

#### 1.6 价格计算系统

##### 基础价格表
```
车型配置示例：
- 鸿日S1-23款磷酸铁锂4kw心动版-标配: 高级¥21,900 / 低级¥25,800
- 鸿日S1Pro-24款铅酸4kw冠军版-转向+铝轮: 高级¥24,900 / 低级¥28,300
- 鸿日S1Max-23款铅酸4kw豪华版-转向+铝轮: 高级¥27,580 / 低级¥31,500
- 御虎-御虎新款-自动档: 高级¥35,700 / 低级¥35,700
```

##### 总价计算公式
```
总金额 = 基础价格 + 增加配置总价 + 其他费用总价 + 提车服务费
```

#### 1.7 操作功能
- **加入购物车**：保存订单草稿
- **提交订单**：正式提交订单，生成订单号
- **表单验证**：确保必填项完整
- **价格实时计算**：选择变更时自动更新总价

### 2. 经销商订单列表页面 (`pages/dealer/orders/orders`)

#### 2.1 页面结构
- **导航栏**：包含"下单"和"订单"两个标签
- **订单列表**：显示当前经销商的所有订单

#### 2.2 订单列表功能

##### 订单信息展示
- **订单号**：格式为HR+日期+流水号（鸿日车）或qt+日期+流水号（其他品牌）
- **车辆信息**：车型系列、具体车型、配置、颜色
- **订单金额**：总金额显示
- **订单状态**：当前订单状态及状态文字
- **创建时间**：订单创建时间

##### 订单状态管理
1. **待提交**（pending）：橙色标签
2. **已提交待确认调车**（submitted）：蓝色标签
3. **已调车待发货**（confirmed）：绿色标签
4. **已发货结算**（shipped）：紫色标签
5. **已完成**（completed）：深绿色标签

##### 操作功能
- **查看详情**：点击订单项跳转到订单详情页
- **提交订单**：待提交状态的订单可以提交
- **编辑订单**：待提交状态的订单可以编辑
- **状态筛选**：按订单状态筛选显示

#### 2.3 空状态处理
- 无订单时显示空状态页面
- 提供"立即下单"按钮引导用户

### 3. 经销商订单详情页面 (`pages/dealer/orders/detail/detail`)

#### 3.1 页面结构
- **订单状态区域**：顶部状态展示
- **详细信息区域**：分区块展示订单信息
- **操作按钮区域**：底部操作按钮

#### 3.2 订单状态展示
- **状态图标**：不同状态对应不同emoji图标
- **状态文字**：当前订单状态描述
- **订单号**：完整订单编号

#### 3.3 车辆信息区块
- **经销商**：下单经销商名称
- **车型系列**：选择的车型系列
- **车型**：具体车型型号
- **配置**：车辆配置信息
- **颜色**：选择的车辆颜色
- **基础价格**：车辆基础价格

#### 3.4 增加配置区块
- **配置列表**：已选择的增加配置项
- **配置价格**：每项配置的价格
- **配置小计**：增加配置总价

#### 3.5 其他费用区块
- **费用列表**：保险、运费、加价等费用项
- **费用价格**：各项费用金额
- **费用小计**：其他费用总价

#### 3.6 提车方式区块
- **提车方式**：选择的提车方式
- **服务费用**：相关服务费用

#### 3.7 订单金额汇总
- **基础价格**：车辆基础价格
- **增加配置**：配置增加金额
- **其他费用**：附加费用金额
- **提车服务费**：提车相关费用
- **订单总额**：最终总金额（突出显示）

#### 3.8 订单信息区块
- **下单时间**：订单创建时间
- **提交时间**：订单提交时间（如有）
- **确认时间**：订单确认时间（如有）
- **发货时间**：订单发货时间（如有）

#### 3.9 备注信息
- **订单备注**：经销商填写的备注信息

#### 3.10 操作功能
- **提交订单**：待提交状态可提交
- **编辑订单**：待提交状态可编辑
- **查看物流**：已发货状态可查看物流信息

## 技术实现要求

### 4.1 数据库设计

#### 车辆基础价格表
```sql
CREATE TABLE vehicle_base_prices (
  id INT PRIMARY KEY AUTO_INCREMENT,
  vehicle_key VARCHAR(255) UNIQUE,
  high_price DECIMAL(10,2),
  low_price DECIMAL(10,2),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### 经销商订单表
```sql
CREATE TABLE dealer_orders (
  id INT PRIMARY KEY AUTO_INCREMENT,
  order_no VARCHAR(50) UNIQUE,
  dealer_username VARCHAR(100),
  dealer_level VARCHAR(50),
  vehicle_series VARCHAR(100),
  vehicle_model VARCHAR(200),
  vehicle_config VARCHAR(200),
  vehicle_color VARCHAR(50),
  base_price DECIMAL(10,2),
  additional_configs JSON,
  additional_total DECIMAL(10,2),
  other_fees JSON,
  other_fees_total DECIMAL(10,2),
  pickup_method VARCHAR(50),
  delivery_fee DECIMAL(10,2),
  total_amount DECIMAL(10,2),
  status VARCHAR(50),
  remarks TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

#### 用户表扩展
```sql
ALTER TABLE users ADD COLUMN dealer_level VARCHAR(50);
```

### 4.2 权限控制
- 页面访问权限验证
- 基于角色的功能限制
- 数据访问权限控制

### 4.3 数据集成
- 与鸿日库存系统集成
- 实时库存数据获取
- 价格数据同步

### 4.4 用户体验
- 响应式设计
- 加载状态提示
- 错误处理和用户反馈
- 表单验证和数据校验

## 测试用例

### 5.1 登录测试
- 低级批发商登录：`jxs-xz` / `123456`
- 高级批发商登录：`jxs-qx` / `123456`
- 权限验证测试

### 5.2 下单流程测试
- 车型选择级联测试
- 价格计算准确性测试
- 表单验证测试
- 订单提交测试

### 5.3 订单管理测试
- 订单列表显示测试
- 订单状态变更测试
- 订单详情查看测试

## 后续扩展计划

### 6.1 管理端功能
- 订单确认功能
- 调车管理功能
- 发货管理功能

### 6.2 价格管理功能
- 价格配置管理
- 批量价格更新
- 价格历史记录

### 6.3 报表统计功能
- 经销商订单统计
- 销售数据分析
- 库存周转分析

## 项目时间规划

- **需求确认**：1天
- **数据库设计**：1天
- **页面开发**：3天
- **功能测试**：1天
- **联调测试**：1天
- **上线部署**：1天

**总计：8个工作日**

---

*文档版本：v1.0*  
*创建日期：2025年1月22日*  
*最后更新：2025年1月22日* 